import{b as Q,i as T,af as U,u as W,a as V,r as x,j as e,B as j,C as Z,s as m}from"./index-iOXzGFVc.js";import{E as ee}from"./ErrorState-CV5A9HrL.js";import{P as M}from"./PageContainer-B4hCR2uv.js";const ae=()=>{var I,L,P;const{t:s}=Q(),g=T(),v=U(),{data:X}=W(),{user:c}=V(),w=((I=v.state)==null?void 0:I.selectedDay)||"monday",a=((L=v.state)==null?void 0:L.workout)||((P=X.workoutsByDay)==null?void 0:P[w]),[n,N]=x.useState(0),[q,_]=x.useState(!1),[o,z]=x.useState(null),[S,C]=x.useState(!1),D=30,[b,E]=x.useState(D),u=x.useRef(null),A=t=>{if(t&&typeof t=="string"){const i=t.match(/exercise\.([^.]+)\./);if(i&&i[1])return i[1];const p={pushUps:["plank position","chest nearly touches","push back up","knee push-ups"],plankHold:["forearm plank position","straight line","squeeze your glutes","back flat"],tricepDips:["chair","gripping the edge","slide your hips","bend your elbows"],deadBug:["lie on your back","arms straight up","knees bent","lower opposite arm"],sidePlank:["lie on your side","prop up on your elbow","lift your hips","straight line"],mountainClimbers:["plank position","drive one knee","switch legs","shoulders over wrists"],squats:["feet shoulder-width apart","lower your hips","sitting in a chair","push through your heels"],reverseLunges:["step one foot back","lower your knee","front knee over your ankle","balance"],gluteBridge:["lie on your back","knees bent","lift your hips","squeezing your glutes"],catCow:["hands and knees","arch your back","dip it down","breathing deeply"],worldsGreatestStretch:["step one foot forward","lunge","rotate your torso","reach your arm up"],childsPose:["kneel on the floor","sit back on your heels","stretch your arms forward","relax your chest"],jumpingJacks:["jump feet out","raising arms overhead","return to start","step out"],walking:["walk at an easy pace","relax your shoulders","steady breathing","gentle movement"],standingQuadStretch:["stand tall","grab one ankle","knees together","hold wall for balance"],neckRolls:["stand or sit tall","roll your head","relaxing your neck","avoid sudden motions"],breathingPractice:["sit or lie down","inhale slowly","exhale longer","relaxing your body"],bodyScan:["lie down","close your eyes","scan your body","notice tension"]};for(const[R,y]of Object.entries(p))if(y.some(r=>t.toLowerCase().includes(r.toLowerCase())))return R;return"custom"}return"custom"};if(!a||!Array.isArray(a.exercises)||a.exercises.length===0)return e.jsx(ee,{title:s("exercise.noData"),message:s("exercise.noDataMessage","No exercises found for this session"),retryLabel:s("exercise.goBack"),onRetry:()=>g("/workouts")});const G=async()=>{if(!c||!a){_(!0);return}C(!0);try{const i=(Array.isArray(a.exercises)?a.exercises.length:0)*10,p=typeof a.duration=="number"?a.duration:0,{data:R,error:y}=await m.from("workout_sessions").insert({user_id:c.id,day:w,duration_min:p,completed:!0,xp_gained:i}).select("id").single();if(y)throw y;const{data:r}=await m.from("streaks").select("current_streak,best_streak,updated_at").eq("user_id",c.id).maybeSingle(),k=new Date,h=r!=null&&r.updated_at?new Date(r.updated_at):null,F=h&&h.toDateString()===k.toDateString(),H=h&&new Date(h.getFullYear(),h.getMonth(),h.getDate()+1).toDateString()===k.toDateString();let d=(r==null?void 0:r.current_streak)||0;F||(d=H?d+1:1);const B=Math.max((r==null?void 0:r.best_streak)||0,d);await m.from("streaks").upsert({user_id:c.id,current_streak:d,best_streak:B,updated_at:k.toISOString()}),await m.from("activity_feed").insert({user_id:c.id,type:"session_completed",payload:{xp:i,day:w,duration:p}}),d%7===0&&await m.from("activity_feed").insert({user_id:c.id,type:"streak",payload:{current:d}}),i>=100&&await m.from("activity_feed").insert({user_id:c.id,type:"badge",payload:{badge:"Power Hour"}});const{data:O}=await m.from("workout_sessions").select("xp_gained").eq("user_id",c.id),Y=(O||[]).reduce((J,K)=>J+(K.xp_gained||0),0);z({xpGained:i,currentStreak:d,bestStreak:B,totalXp:Y})}catch(t){console.error(t)}finally{C(!1),_(!0)}};if(q){const t=(o==null?void 0:o.xpGained)??a.exercises.length*10,i=(o==null?void 0:o.currentStreak)??1,p=(o==null?void 0:o.totalXp)??t;return e.jsxs(M,{title:s("exercise.sessionComplete"),className:"min-h-screen flex flex-col items-center justify-center text-center relative min-w-0",children:[e.jsx("h2",{className:"text-3xl font-bold text-primary mb-2 mt-8",children:s("exercise.sessionComplete")}),e.jsx("p",{className:"text-lg text-muted-foreground mb-4",children:s("exercise.wellDone")}),e.jsxs("div",{className:"flex flex-col items-center gap-4 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-xl font-bold text-primary",children:["+",t," XP"]}),e.jsxs("span",{className:"bg-primary/10 text-primary px-3 py-1 rounded-full text-sm font-semibold",children:[s("exercise.streak")," +1"]})]}),e.jsxs("div",{className:"flex flex-col gap-2 text-left w-full max-w-xs mx-auto",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:s("exercise.totalXp")}),e.jsx("span",{children:p})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:s("exercise.streak")}),e.jsx("span",{children:i})]})]})]}),e.jsx(j,{className:"w-full btn-primary-premium mt-2 max-w-xs",onClick:()=>g("/"),children:s("exercise.close")})]})}const l=a.exercises[n],f=a.exercises.length,$=f>0?(n+1)/f*100:0;return x.useEffect(()=>(E(D),u.current&&clearInterval(u.current),u.current=setInterval(()=>{E(t=>t<=1?(u.current&&clearInterval(u.current),0):t-1)},1e3),()=>{u.current&&clearInterval(u.current)}),[n]),e.jsxs(M,{title:s("exercise.sessionActive","Exercise Session"),className:"min-h-screen flex flex-col items-center justify-center text-center relative min-w-0 stagger-children",autoFocus:!0,children:[e.jsx("button",{"aria-label":"Close session",className:"absolute top-4 left-4 z-10 p-2 rounded-full hover:bg-muted/40 transition",onClick:()=>g("/workouts"),children:e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"lucide lucide-x text-muted-foreground",children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})}),e.jsx("div",{className:"w-full max-w-xl mx-auto mt-8 mb-6 px-2",children:e.jsx("div",{className:"w-full bg-muted/40 rounded-full h-2 overflow-hidden",children:e.jsx("div",{className:"bg-primary h-2 rounded-full transition-all duration-500 ease-[cubic-bezier(.16,.84,.44,1)]",style:{width:`${$}%`}})})}),e.jsx(Z,{className:"w-full max-w-xl mx-auto flex flex-col py-8 px-4 sm:px-6",children:e.jsxs("div",{className:"w-full flex flex-col mb-6",children:[e.jsxs("div",{className:"flex flex-row items-center gap-3 mb-2",children:[e.jsxs("div",{className:"hidden",children:["Nom de l'exercice: ",l.name]}),e.jsxs("h3",{className:"text-2xl font-bold text-primary text-left m-0 flex items-center",children:[(()=>{const t=A(l.name);return t==="custom"?l.name||s("exercise.custom.title","Custom Exercise"):s(`exercise.${t}.title`)})(),e.jsxs("span",{className:"text-2xl font-bold text-primary ml-2 align-middle",children:["x",l.reps]})]})]}),e.jsx("div",{className:"text-md text-foreground font-medium text-left max-w-lg mb-2 leading-relaxed",children:(()=>{const t=A(l.name);return t==="custom"?l.description||l.name:s(`exercise.${t}.description`)})()}),e.jsx("div",{className:"text-base text-muted-foreground italic mb-2 text-left",children:l.modification}),e.jsx("div",{className:"text-sm text-primary font-medium text-left max-w-lg leading-relaxed",children:l.tips})]})}),e.jsxs("div",{className:"w-full max-w-xl mx-auto flex flex-col sm:flex-row gap-4 justify-center mt-8 px-2",children:[e.jsx(j,{variant:"outline",onClick:()=>N(n<f-1?n+1:n),className:"w-full sm:w-1/2",disabled:n===f-1,children:s("exercise.skip")}),e.jsx(j,{className:"w-full sm:w-1/2 btn-primary-premium",onClick:async()=>{n<f-1?N(n+1):await G()},disabled:b>0||S,children:S?"...":b>0?`${b}s`:n===f-1?s("exercise.finish"):s("exercise.next")})]})]})};export{ae as default};
