import{a as q,i as B,r as g,b as D,j as e,B as h,I as m,s as k}from"./index-BfZ5KBQI.js";import{L as c,S as G}from"./switch-DGtvxFML.js";function T(){const{user:r}=q(),M=B(),[o,v]=g.useState(0),u=4,w=g.useMemo(()=>Math.round((o+1)/u*100),[o]),[y,p]=g.useState(!1),[n,N]=g.useState({name:"",birthdate:"",height_cm:"",weight_kg:"",goal:"",workout_duration:"25",daily_reminder:!1,dark_mode:!1,weekly_goal:"3"}),{t:a}=D();g.useEffect(()=>{(async()=>{if(!r)return;const{data:s}=await k.from("profiles").select("name,birthdate,height_cm,weight_kg,goal").eq("user_id",r.id).maybeSingle(),{data:t}=await k.from("preferences").select("workout_duration,daily_reminder,dark_mode,weekly_goal").eq("user_id",r.id).maybeSingle();N(l=>{var x,f,b,C,_,S,j,F;return{...l,name:(s==null?void 0:s.name)??l.name,birthdate:(s==null?void 0:s.birthdate)??l.birthdate,height_cm:((f=(x=s==null?void 0:s.height_cm)==null?void 0:x.toString)==null?void 0:f.call(x))??l.height_cm,weight_kg:((C=(b=s==null?void 0:s.weight_kg)==null?void 0:b.toString)==null?void 0:C.call(b))??l.weight_kg,goal:(s==null?void 0:s.goal)??l.goal,workout_duration:((S=(_=t==null?void 0:t.workout_duration)==null?void 0:_.toString)==null?void 0:S.call(_))??l.workout_duration,daily_reminder:(t==null?void 0:t.daily_reminder)??l.daily_reminder,dark_mode:(t==null?void 0:t.dark_mode)??l.dark_mode,weekly_goal:((F=(j=t==null?void 0:t.weekly_goal)==null?void 0:j.toString)==null?void 0:F.call(j))??l.weekly_goal}})})()},[r==null?void 0:r.id]);const d=(i,s)=>N(t=>({...t,[i]:s})),L=()=>v(i=>Math.min(u-1,i+1)),E=()=>v(i=>Math.max(0,i-1)),I=async()=>{if(!r)return;p(!0),await k.from("profiles").upsert({user_id:r.id,name:n.name||null,email:r.email,birthdate:n.birthdate||null,height_cm:n.height_cm?Number(n.height_cm):null,weight_kg:n.weight_kg?Number(n.weight_kg):null,goal:n.goal||null}),await k.from("preferences").upsert({user_id:r.id,workout_duration:n.workout_duration?Number(n.workout_duration):25,daily_reminder:!!n.daily_reminder,dark_mode:!!n.dark_mode,weekly_goal:n.weekly_goal?Number(n.weekly_goal):3});const i=document.documentElement;n.dark_mode?i.classList.add("dark"):i.classList.remove("dark"),p(!1),M("/")};return r?e.jsx("div",{className:"min-h-[calc(100vh-3.5rem)] flex items-center justify-center p-4 min-w-0",children:e.jsxs("div",{className:"w-full max-w-xl space-y-6 border rounded-xl p-6 bg-card",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:a("onboarding.step",{current:o+1,total:u})}),e.jsxs("span",{className:"text-sm font-medium",children:[w,"%"]})]}),e.jsx("div",{className:"h-2 w-full bg-muted rounded",children:e.jsx("div",{className:"h-2 bg-primary rounded",style:{width:`${w}%`}})})]}),o===0&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h2",{className:"text-xl font-bold",children:a("onboarding.aboutYou")}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 stagger-children",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(c,{htmlFor:"name",children:a("onboarding.name")}),e.jsx(m,{id:"name",placeholder:a("profileSocial.yourNamePlaceholder"),value:n.name,onChange:i=>d("name",i.target.value)})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(c,{htmlFor:"birthdate",children:a("onboarding.birthdate")}),e.jsx(m,{id:"birthdate",type:"date",value:n.birthdate,onChange:i=>d("birthdate",i.target.value)})]})]})]}),o===1&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h2",{className:"text-xl font-bold",children:a("onboarding.bodyMetrics")}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 stagger-children",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(c,{htmlFor:"height",children:a("onboarding.heightCm")}),e.jsx(m,{id:"height",type:"number",inputMode:"numeric",value:n.height_cm,onChange:i=>d("height_cm",i.target.value)})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(c,{htmlFor:"weight",children:a("onboarding.weightKg")}),e.jsx(m,{id:"weight",type:"number",inputMode:"numeric",value:n.weight_kg,onChange:i=>d("weight_kg",i.target.value)})]})]})]}),o===2&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h2",{className:"text-xl font-bold",children:a("onboarding.primaryGoal")}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(c,{htmlFor:"goal",children:a("onboarding.goalQuestion")}),e.jsx(m,{id:"goal",placeholder:a("onboarding.goalPlaceholder"),value:n.goal,onChange:i=>d("goal",i.target.value)})]})]}),o===3&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h2",{className:"text-xl font-bold",children:a("onboarding.preferences")}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 stagger-children",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(c,{htmlFor:"duration",children:a("onboarding.workoutDuration")}),e.jsx(m,{id:"duration",type:"number",inputMode:"numeric",value:n.workout_duration,onChange:i=>d("workout_duration",i.target.value)})]}),e.jsxs("div",{className:"space-y-1 flex items-center justify-between md:block",children:[e.jsx(c,{htmlFor:"reminder",children:a("onboarding.dailyReminder")}),e.jsx("div",{className:"mt-1",children:e.jsx(G,{id:"reminder",checked:!!n.daily_reminder,onCheckedChange:i=>d("daily_reminder",i)})})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(c,{htmlFor:"theme",children:a("onboarding.theme")}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(h,{type:"button",variant:n.dark_mode?"outline":"default",onClick:()=>d("dark_mode",!1),children:a("onboarding.light")}),e.jsx(h,{type:"button",variant:n.dark_mode?"default":"outline",onClick:()=>d("dark_mode",!0),children:a("onboarding.dark")})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(c,{htmlFor:"weekly_goal",children:a("onboarding.weeklyGoal")}),e.jsx(m,{id:"weekly_goal",type:"number",inputMode:"numeric",min:1,max:14,value:n.weekly_goal,onChange:i=>d("weekly_goal",i.target.value)})]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-2",children:[e.jsx(h,{variant:"outline",onClick:E,disabled:o===0||y,children:a("onboarding.back")}),o<u-1?e.jsx(h,{onClick:L,children:a("onboarding.continue")}):e.jsx(h,{onClick:I,disabled:y,children:a(y?"onboarding.saving":"onboarding.finish")})]})]})}):e.jsx("div",{className:"min-h-[calc(100vh-3.5rem)] flex items-center justify-center p-4 min-w-0",children:e.jsxs("div",{className:"w-full max-w-md space-y-4 border rounded-xl p-6 bg-card text-center",children:[e.jsx("h1",{className:"text-xl font-bold",children:a("onboarding.pleaseSignInTitle")}),e.jsx("p",{className:"text-muted-foreground",children:a("onboarding.pleaseSignInDesc")}),e.jsx("a",{href:"/login",className:"inline-block",children:e.jsx(h,{children:a("onboarding.goToLogin")})})]})})}export{T as default};
